name: 'Resource Group Issue Workflow'

on:
  issues:
    types: [labeled]
  workflow_dispatch:

concurrency:
  group: issue-${{ github.event.issue.number }}
  cancel-in-progress: true
  
permissions:
  id-token: write
  contents: read
  issues: write

jobs:
  pre-checking:
    runs-on: ubuntu-latest
    # 라벨 이벤트인 경우 'resource_group' 라벨이 있을 때만 실행
    if: github.event.label.name == 'resource_group' || contains(github.event.issue.labels.*.name, 'resource_group')
    outputs:
      resource_group: ${{ steps.get-resource-group.outputs.resource_group }}
      poc_name: ${{ steps.extract-poc-info.outputs.poc_name }}
      has_poc: ${{ steps.extract-poc-info.outputs.has_poc }}
    steps:
      - name: Check for Resource Group Label
        id: check-label
        run: |
          # 이슈에 'resource group' 라벨이 있는지 확인
          IS_LABELED=false
          
          # 이벤트 유형 확인
          if [ "${{ github.event_name }}" = "issues" ] && [ "${{ github.event.action }}" = "labeled" ]; then
            # 라벨 이벤트인 경우
            LABEL="${{ github.event.label.name }}"
            if [ "$LABEL" = "resource_group" ]; then
              IS_LABELED=true
            fi
          else
            # 이슈 오픈 이벤트인 경우 라벨 목록 확인
            LABELS="${{ toJSON(github.event.issue.labels) }}"
            if [[ $LABELS == *"resource_group"* ]]; then
              IS_LABELED=true
            fi
          fi
          
          if [ "$IS_LABELED" = "false" ]; then
            echo "❌ This workflow only runs with the 'resource_group' label."
            exit 1
          fi
          
          echo "✅ Resource Group label detected."
      
      - name: Extract Resource Group from Issue (Issue Forms)
        id: get-resource-group
        uses: actions/github-script@v6
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const issue_number = context.payload.issue.number;
            const repo = context.repo;
            
            // 이슈 상세 정보 가져오기
            const issue = await github.rest.issues.get({
              owner: repo.owner,
              repo: repo.repo,
              issue_number: issue_number
            });
            
            let resourceGroup = null;
            const issueBody = issue.data.body;
            
            // GitHub Issue Forms 형식(structured forms) 파싱
            // 이슈 템플릿의 input field "id: resource-group-name"과 "label: 리소스_그룹명" 찾기
            if (issueBody) {
              // 방법 1: label로 찾기
              const rgLabelMatch = issueBody.match(/###\s+리소스_그룹명\s*([\s\S]*?)(?=###|$)/);
              if (rgLabelMatch && rgLabelMatch[1]) {
                resourceGroup = rgLabelMatch[1].trim();
              }
              
              // 방법 2: 여러 가능한 형식 고려하기
              if (!resourceGroup) {
                const possiblePatterns = [
                  /###\s+리소스_그룹명\s*([\s\S]*?)(?=###|$)/,
                  /리소스_그룹명:?\s*([a-zA-Z0-9_-]+)/i,
                  /리소스\s+그룹:?\s*([a-zA-Z0-9_-]+)/i,
                  /resource\s+group:?\s*([a-zA-Z0-9_-]+)/i,
                  /배포할\s+리소스\s+그룹의\s+이름.*\n\s*([a-zA-Z0-9_-]+)/i
                ];
                
                for (const pattern of possiblePatterns) {
                  const match = issueBody.match(pattern);
                  if (match && match[1]) {
                    resourceGroup = match[1].trim();
                    break;
                  }
                }
              }
            }
            
            if (!resourceGroup) {
              console.log('❌ Resource Group name not found in the issue body using standard patterns');
              
              // 마지막 시도: 이슈 본문에서 가능한 리소스 그룹명 찾기
              const lines = issueBody.split('\n');
              for (let i = 0; i < lines.length; i++) {
                const line = lines[i].trim();
                // 알파벳, 숫자, 하이픈, 언더스코어로 구성된 가능한 리소스 그룹명 패턴
                const rgNamePattern = /^[a-zA-Z0-9][a-zA-Z0-9_-]{2,62}$/;
                
                if (rgNamePattern.test(line) && line.indexOf(' ') === -1) {
                  // 공백 없는 적합한 명명 규칙을 가진 줄이 있을 경우
                  resourceGroup = line;
                  console.log(`✅ Found potential resource group name: ${resourceGroup}`);
                  break;
                }
              }
            }
            
            if (!resourceGroup) {
              core.setFailed('Resource Group name not found in the issue body');
              return;
            }
            
            console.log(`✅ Resource Group name: ${resourceGroup}`);
            core.setOutput('resource_group', resourceGroup);

      - name: Extract POC from Labels
        id: extract-poc-info
        uses: actions/github-script@v6
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            console.log(`이슈 #${context.payload.issue.number} POC 정보 추출 중`);
            
            try {
              // 이슈 정보 가져오기
              const issue = await github.rest.issues.get({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: context.payload.issue.number
              });
              
              // 이슈 라벨 확인
              const labels = issue.data.labels || [];
              console.log(`이슈에 총 ${labels.length}개의 라벨이 있습니다.`);
              
              // POC 라벨 찾기 (POC: 로 시작하는 라벨)
              const pocLabels = labels.filter(label => {
                const labelName = label.name || '';
                return labelName.startsWith('POC:');
              });
              
              console.log(`${pocLabels.length}개의 POC 라벨이 발견되었습니다.`);
              
              let hasPOC = false;
              let pocName = '';
              
              if (pocLabels.length > 0) {
                // POC 라벨 정보 추출
                const pocInfo = pocLabels.map(label => {
                  const labelName = label.name;
                  const pocName = labelName.substring(4).trim(); // "POC:" 부분 제거
                  return {
                    fullLabel: labelName,
                    pocName: pocName,
                    color: label.color
                  };
                });
                
                console.log('발견된 POC 정보:', JSON.stringify(pocInfo, null, 2));
                
                // 이슈에 POC 정보 코멘트 추가
                let comment = '### 이 이슈에 연결된 POC 정보:\n\n';
                
                pocInfo.forEach(poc => {
                  comment += `- **${poc.pocName}** (라벨: \`${poc.fullLabel}\`)\n`;
                });
                
                hasPOC = true;
                pocName = pocInfo[0].pocName; // 첫 번째 POC 이름 사용
                
                // 기존 코멘트가 있는지 확인
                const comments = await github.rest.issues.listComments({
                  owner: context.repo.owner,
                  repo: context.repo.repo,
                  issue_number: context.payload.issue.number
                });
                
                // 같은 봇이 작성한 기존 POC 정보 코멘트 찾기
                const botComments = comments.data.filter(comment => {
                  return comment.user.type === 'Bot' && 
                         comment.body.includes('이 이슈에 연결된 POC 정보:');
                });
                
                if (botComments.length > 0) {
                  // 기존 코멘트 업데이트
                  await github.rest.issues.updateComment({
                    owner: context.repo.owner,
                    repo: context.repo.repo,
                    comment_id: botComments[0].id,
                    body: comment
                  });
                  console.log('기존 POC 정보 코멘트가 업데이트되었습니다.');
                } else {
                  // 새 코멘트 작성
                  await github.rest.issues.createComment({
                    owner: context.repo.owner,
                    repo: context.repo.repo,
                    issue_number: context.payload.issue.number,
                    body: comment
                  });
                  console.log('POC 정보 코멘트가 추가되었습니다.');
                }
              } else {
                console.log('이 이슈에는 POC 라벨이 없습니다.');
                hasPOC = false;
                
                // POC가 없다는 코멘트 추가
                const noPocComment = '### ⚠️ 프로젝트 정보 누락\n\n이 이슈에 POC 정보가 없습니다. 적절한 POC 라벨(`POC:이름`)을 추가해주세요.';
                
                // 기존 코멘트가 있는지 확인
                const comments = await github.rest.issues.listComments({
                  owner: context.repo.owner,
                  repo: context.repo.repo,
                  issue_number: context.payload.issue.number
                });
                
                // 기존 POC 정보 코멘트 찾기
                const pocComments = comments.data.filter(comment => {
                  return comment.user.type === 'Bot' && 
                         (comment.body.includes('이 이슈에 연결된 POC 정보:') || 
                          comment.body.includes('⚠️ 프로젝트 정보 누락'));
                });
                
                if (pocComments.length > 0) {
                  // 기존 코멘트 업데이트
                  await github.rest.issues.updateComment({
                    owner: context.repo.owner,
                    repo: context.repo.repo,
                    comment_id: pocComments[0].id,
                    body: noPocComment
                  });
                  console.log('기존 코멘트가 POC 누락 메시지로 업데이트되었습니다.');
                } else {
                  // 새 코멘트 작성
                  await github.rest.issues.createComment({
                    owner: context.repo.owner,
                    repo: context.repo.repo,
                    issue_number: context.payload.issue.number,
                    body: noPocComment
                  });
                  console.log('POC 정보 누락 코멘트가 추가되었습니다.');
                }
              }
              
              // 출력 설정
              core.setOutput('has_poc', hasPOC.toString());
              core.setOutput('poc_name', pocName);
              
            } catch (error) {
              console.error('POC 정보 추출 중 오류 발생:', error.message);
              core.setOutput('has_poc', 'false');
              core.setOutput('poc_name', '');
              
              // 오류 정보를 이슈에 코멘트로 추가
              try {
                await github.rest.issues.createComment({
                  owner: context.repo.owner,
                  repo: context.repo.repo,
                  issue_number: context.payload.issue.number,
                  body: `### ❌ POC 라벨 추출 중 오류 발생\n\n\`\`\`\n${error.message}\n\`\`\``
                });
              } catch (commentError) {
                console.error('코멘트 추가 중 추가 오류 발생:', commentError.message);
              }
            }
      
      - name: Add Resource Group Summary
        run: |
          echo "## 리소스 그룹 및 POC 검증 결과" >> $GITHUB_STEP_SUMMARY
          echo "- 이슈 번호: #${{ github.event.issue.number }}" >> $GITHUB_STEP_SUMMARY
          echo "- 식별된 리소스 그룹: **${{ steps.get-resource-group.outputs.resource_group }}**" >> $GITHUB_STEP_SUMMARY
          echo "- POC 정보: **${{ steps.extract-poc-info.outputs.has_poc == 'true' && steps.extract-poc-info.outputs.poc_name || '없음' }}**" >> $GITHUB_STEP_SUMMARY
          echo "- 상태: ✅ 검증 완료" >> $GITHUB_STEP_SUMMARY

  terraform-plan:
    needs: pre-checking
    runs-on: ubuntu-latest
    # POC 정보가 있는 경우에만 진행
    if: needs.pre-checking.outputs.has_poc == 'true'
    
    env:
      ARM_USE_OIDC: true
      ARM_CLIENT_ID: ${{ secrets.AZURE_CLIENT_ID }}
      ARM_TENANT_ID: ${{ secrets.AZURE_TENANT_ID }}
      ARM_SUBSCRIPTION_ID: ${{ secrets.AZURE_SUBSCRIPTION_ID }}
      TF_VAR_resource_group_name: ${{ needs.pre-checking.outputs.resource_group }}
    
    steps:
      - uses: actions/checkout@v3
      
      - name: 'Check if secrets are set'
        id: check-secrets
        run: |
          SECRETS_STATUS="✅ 모든 Azure 시크릿이 설정되었습니다."
          
          if [ -z "${{ secrets.AZURE_CLIENT_ID }}" ]; then
            echo "❌ AZURE_CLIENT_ID is missing"
            SECRETS_STATUS="❌ AZURE_CLIENT_ID가 누락되었습니다."
            exit 1
          fi
          if [ -z "${{ secrets.AZURE_TENANT_ID }}" ]; then
            echo "❌ AZURE_TENANT_ID is missing"
            SECRETS_STATUS="❌ AZURE_TENANT_ID가 누락되었습니다."
            exit 1
          fi
          if [ -z "${{ secrets.AZURE_SUBSCRIPTION_ID }}" ]; then
            echo "❌ AZURE_SUBSCRIPTION_ID is missing"
            SECRETS_STATUS="❌ AZURE_SUBSCRIPTION_ID가 누락되었습니다."
            exit 1
          fi
          echo "✅ All secrets are set"
          echo "secrets_status=$SECRETS_STATUS" >> $GITHUB_OUTPUT
      
      - name: 'Az CLI login with OIDC'
        id: azure-login
        uses: azure/login@v1
        with:
          client-id: ${{ secrets.AZURE_CLIENT_ID }}
          tenant-id: ${{ secrets.AZURE_TENANT_ID }}
          subscription-id: ${{ secrets.AZURE_SUBSCRIPTION_ID }}
      
      - name: Setup Terraform
        uses: hashicorp/setup-terraform@v2
      
      - name: Terraform Init
        id: tf-init
        run: |
          terraform init
          echo "## Terraform 초기화" >> $GITHUB_STEP_SUMMARY
          echo "- 상태: ✅ 초기화 완료" >> $GITHUB_STEP_SUMMARY
      
      - name: Terraform Plan
        id: plan
        run: |
          terraform plan -var="resource_group_name=${TF_VAR_resource_group_name}" -out=tfplan
          
          # Plan 상태 캡처 (개선된 방식)
          PLAN_OUTPUT=$(terraform show -no-color tfplan)
          
          # 리소스 변경 계산 방식 개선
          RESOURCES_TO_ADD=$(echo "$PLAN_OUTPUT" | grep -E '^\s*\+\s' | wc -l)
          RESOURCES_TO_CHANGE=$(echo "$PLAN_OUTPUT" | grep -E '^\s*~\s' | wc -l)
          RESOURCES_TO_DESTROY=$(echo "$PLAN_OUTPUT" | grep -E '^\s*-\s' | wc -l)
          
          # 요약 추가
          echo "## Terraform Plan 결과" >> $GITHUB_STEP_SUMMARY
          echo "- 리소스 그룹: **${TF_VAR_resource_group_name}**" >> $GITHUB_STEP_SUMMARY
          echo "- POC: **${{ needs.pre-checking.outputs.poc_name }}**" >> $GITHUB_STEP_SUMMARY
          echo "- 상태: ✅ Plan 완료" >> $GITHUB_STEP_SUMMARY
      
      - name: Upload Terraform Plan
        uses: actions/upload-artifact@v4
        with:
          name: terraform-plan
          path: tfplan
          retention-days: 1
      
      - name: Post Plan Result to Issue
        uses: actions/github-script@v6
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const issue_number = context.payload.issue.number;
            github.rest.issues.createComment({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: issue_number,
              body: `## Terraform Plan 완료 ✅
              
              리소스 그룹: \`${{ needs.pre-checking.outputs.resource_group }}\`
              POC: \`${{ needs.pre-checking.outputs.poc_name }}\`
              
              Plan이 완료되었습니다. 팀장님의 승인 후 Apply가 진행됩니다.`
            });

  handle-missing-poc:
    needs: pre-checking
    if: needs.pre-checking.outputs.has_poc == 'false'
    runs-on: ubuntu-latest
    steps:
      - name: Update Summary for Missing POC
        run: |
          echo "## 작업 중단 - POC 정보 누락" >> $GITHUB_STEP_SUMMARY
          echo "- 리소스 그룹: **${{ needs.pre-checking.outputs.resource_group }}**" >> $GITHUB_STEP_SUMMARY
          echo "- 상태: ❌ POC 정보가 누락되어 배포가 중단되었습니다" >> $GITHUB_STEP_SUMMARY
          echo "- 조치: POC 라벨을 추가한 후 다시 시도해주세요." >> $GITHUB_STEP_SUMMARY

      - name: Remove Resource Group Label
        uses: actions/github-script@v6
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            try {
              await github.rest.issues.removeLabel({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: context.payload.issue.number,
                name: 'resource_group'
              });
              console.log('resource_group 라벨이 제거되었습니다.');
            } catch (e) {
              console.log('라벨 제거 중 오류 발생:', e.message);
            }

  terraform-apply:
    needs: [pre-checking, terraform-plan]
    runs-on: ubuntu-latest
    # POC 정보가 있는 경우에만 진행
    if: needs.pre-checking.outputs.has_poc == 'true'
    environment: 
      name: production
      url: ${{ github.server_url }}/${{ github.repository }}/issues/${{ github.event.issue.number }}
    outputs:
      approval_status: ${{ steps.get_approval_status.outputs.status }}
      started: ${{ steps.mark-start.outputs.started }}
      
    env:
      ARM_USE_OIDC: true
      ARM_CLIENT_ID: ${{ secrets.AZURE_CLIENT_ID }}
      ARM_TENANT_ID: ${{ secrets.AZURE_TENANT_ID }}
      ARM_SUBSCRIPTION_ID: ${{ secrets.AZURE_SUBSCRIPTION_ID }}
      TF_VAR_resource_group_name: ${{ needs.pre-checking.outputs.resource_group }}
    
    steps:
      - name: Get Approval Status
        id: get_approval_status
        run: |
          # 환경 보호 검토 상태 확인
          # GitHub Actions에서는 이 값을 직접 얻을 수 없으므로, 그냥 성공했다고 가정
          # 실제로는 워크플로우가 여기까지 진행되면 승인된 것임
          echo "status=approved" >> $GITHUB_OUTPUT
          
          # 요약 추가
          echo "## 승인 정보" >> $GITHUB_STEP_SUMMARY
          echo "- 환경: **production**" >> $GITHUB_STEP_SUMMARY
          echo "- 상태: ✅ 승인됨" >> $GITHUB_STEP_SUMMARY

      - name: Mark job started
        id: mark-start
        run: echo "started=true" >> $GITHUB_OUTPUT

      - uses: actions/checkout@v3
      
      - name: 'Az CLI login with OIDC'
        uses: azure/login@v1
        with:
          client-id: ${{ secrets.AZURE_CLIENT_ID }}
          tenant-id: ${{ secrets.AZURE_TENANT_ID }}
          subscription-id: ${{ secrets.AZURE_SUBSCRIPTION_ID }}
      
      - name: Setup Terraform
        uses: hashicorp/setup-terraform@v2
      
      - name: Download Terraform Plan
        uses: actions/download-artifact@v4
        with:
          name: terraform-plan
      
      - name: Terraform Init
        run: terraform init
      
      - name: Terraform Apply
        id: apply
        run: |
          terraform apply -auto-approve tfplan
          
          # 요약 시작
          echo "## Terraform Apply 결과" >> $GITHUB_STEP_SUMMARY
          echo "- 리소스 그룹: **${TF_VAR_resource_group_name}**" >> $GITHUB_STEP_SUMMARY
          echo "- POC: **${{ needs.pre-checking.outputs.poc_name }}**" >> $GITHUB_STEP_SUMMARY
          echo "- 상태: ✅ 성공적으로 배포됨" >> $GITHUB_STEP_SUMMARY
          
          # 리소스 목록 출력 (선택적)
          echo "### 배포된 리소스" >> $GITHUB_STEP_SUMMARY
          terraform state list | while read -r resource; do
            echo "- \`$resource\`" >> $GITHUB_STEP_SUMMARY
          done
      
      - name: Post Apply Result to Issue
        if: ${{ success() }}
        uses: actions/github-script@v6
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const issue_number = context.payload.issue.number;
            github.rest.issues.createComment({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: issue_number,
              body: `## Terraform Apply 완료 ✅
              
              리소스 그룹: \`${{ needs.pre-checking.outputs.resource_group }}\`
              POC: \`${{ needs.pre-checking.outputs.poc_name }}\`
              
              인프라 배포가 완료되었습니다.`
            });

  handle-rejection:
    needs: terraform-apply
    # 수정된 조건: terraform-apply가 완료되기 전에 실패하거나 취소된 경우에만 실행
    if: >
      always() && 
      (needs.terraform-apply.result == 'failure' || 
       needs.terraform-apply.result == 'cancelled' || 
       needs.terraform-apply.result == 'skipped') && 
      needs.terraform-apply.outputs.started != 'true' &&
      needs.pre-checking.outputs.has_poc == 'true'
    runs-on: ubuntu-latest
    steps:
      - name: Update Summary for Rejection
        run: |
          echo "## 배포 거절 정보" >> $GITHUB_STEP_SUMMARY
          echo "- 리소스 그룹: **${{ needs.pre-checking.outputs.resource_group }}**" >> $GITHUB_STEP_SUMMARY
          echo "- POC: **${{ needs.pre-checking.outputs.poc_name }}**" >> $GITHUB_STEP_SUMMARY
          echo "- 상태: ❌ 배포 요청이 거절되었습니다" >> $GITHUB_STEP_SUMMARY
          echo "- 조치: 이슈에 거절 코멘트가 추가되었습니다" >> $GITHUB_STEP_SUMMARY

      - uses: actions/github-script@v6
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const {owner, repo} = context.repo;
            const issue_number = context.payload.issue.number;

            // 1) 거절 코멘트
            await github.rest.issues.createComment({
              owner, repo, issue_number,
              body: `## Terraform Apply 거절됨 ❌

              팀장님이 배포 요청을 반려했습니다.  
              이슈 내용을 수정한 뒤 **'resource_group' 라벨을 다시 달아** 재요청해 주세요.`
            });

            // 2) 기존 resource_group 라벨 제거
            try {
              await github.rest.issues.removeLabel({
                owner, repo, issue_number,
                name: 'resource_group'
              });
            } catch (e) {
              // 이미 없을 수도 있으므로 무시
            }

            // 3) 상태 표시용 라벨 추가(선택)
            await github.rest.issues.addLabels({
              owner, repo, issue_number,
              labels: ['deployment-rejected']
            });

  cleanup-artifacts:
    needs: [terraform-plan, handle-rejection]
    if: always()
    runs-on: ubuntu-latest

    # 🟢 아티팩트 삭제용 API 호출 권한
    permissions:
      actions: write

    steps:
      - name: Update Summary for Cleanup
        run: |
          echo "## 아티팩트 정리" >> $GITHUB_STEP_SUMMARY
          echo "- 작업: terraform-plan 아티팩트 정리" >> $GITHUB_STEP_SUMMARY
          echo "- 상태: 진행 중..." >> $GITHUB_STEP_SUMMARY

      - name: List available artifacts
        uses: actions/github-script@v6
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const artifacts = await github.rest.actions.listWorkflowRunArtifacts({
              owner: context.repo.owner,
              repo: context.repo.repo,
              run_id: context.runId
            });
            
            console.log('Available artifacts:');
            for (const artifact of artifacts.data.artifacts) {
              console.log(`- ${artifact.name} (ID: ${artifact.id})`);
            }
            
      - name: Delete terraform-plan artifact
        id: delete-artifact
        uses: actions/github-script@v6
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const artifacts = await github.rest.actions.listWorkflowRunArtifacts({
              owner: context.repo.owner,
              repo: context.repo.repo,
              run_id: context.runId
            });
            
            const matchArtifact = artifacts.data.artifacts.filter((artifact) => {
              return artifact.name === "terraform-plan"
            })[0];
            
            let deleteStatus = "❌ 아티팩트를 찾을 수 없음";
            
            if (matchArtifact) {
              await github.rest.actions.deleteArtifact({
                owner: context.repo.owner,
                repo: context.repo.repo,
                artifact_id: matchArtifact.id
              });
              console.log(`Successfully deleted artifact: terraform-plan (ID: ${matchArtifact.id})`);
              deleteStatus = "✅ 성공적으로 삭제됨";
            } else {
              console.log('No terraform-plan artifact found');
            }
            
            // 요약 업데이트
            const fs = require('fs');
            fs.appendFileSync(process.env.GITHUB_STEP_SUMMARY, `- terraform-plan: **${deleteStatus}**\n`);
            
      - name: Final Workflow Summary
        run: |
          echo "## 워크플로우 완료" >> $GITHUB_STEP_SUMMARY
          echo "- 전체 상태: ✅ 워크플로우 완료" >> $GITHUB_STEP_SUMMARY
          echo "- 실행 시간: $(date)" >> $GITHUB_STEP_SUMMARY